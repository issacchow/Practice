#### 状态切换条件表

| 状态       | 事件/条件(信号) | 动作(是完成次态的过程)                           | 新状态(次态) |      |
| ---------- | --------------- | ------------------------------------------------ | ------------ | ---- |
| 初始化     | 创建新订单      | 创建订单记录；                                   |              |      |
| 订单已创建 | 用户取消        | 记录取消原因；恢复库存                           | 订单已取消   |      |
|            | 后台取消        | 记录取消原因;  恢复库存                          | 订单已取消   |      |
|            | 用户发起支付    | 生成支付单;关联支付单号与订单;                   | 待支付       |      |
|            |                 |                                                  |              |      |
|            |                 |                                                  |              |      |
|            |                 |                                                  |              |      |
| 待支付     | 支付成功        | 更新支付单状态；记录支付流水；                   | 已付款       |      |
|            | 支付超时        | 取消支付单；记录支付超时；记录取消原因；         | 订单取消中   |      |
|            |                 |                                                  |              |      |
| 已付款     | 审批成功        | 记录审批信息(审批人、时间)                       | 待发货       |      |
|            | 审批失败        | 记录审批信息(审批人、时间、原因); 记录取消原因； |              |      |
|            |                 |                                                  |              |      |
| 待发货     | 取消发货        | 记录取消原因                                     | 订单创建     |      |
|            | 开始发货        | 生成出货单；绑定出货单；异步通知用户             | 已发货       |      |
|            |                 |                                                  |              |      |
| 已发货     | 用户签收        | 记录签收时间                                     | 已签收       |      |
|            | 用户拒收        | 记录拒收时间；记录拒收原因                       | 拒收         |      |
|            |                 |                                                  |              |      |
| 已签收     | 确认收货        | 记录确认收货时间                                 | 订单完成     |      |
|            | 自动确认收货    |                                                  | 订单完成     |      |
|            | 用户申请退货    |                                                  | 退货申请     |      |
|            |                 |                                                  |              |      |
| 退货申请   | ...             | ...                                              | ...          |      |
|            |                 |                                                  |              |      |
| ...        |                 |                                                  |              |      |
|            |                 |                                                  |              |      |
|            |                 |                                                  |              |      |
|            |                 |                                                  |              |      |



#### 状态切换表

| 当前态↓  / 次态→ | 初始化 | 订单已创建 | 已取消 | 待支付 | 已付款 | 待发货 | 已发货 | 已签收 | 退货申请 | 已退货 |
| ---------------- | ------ | ---------- | ------ | ------ | ------ | ------ | ------ | ------ | -------- | ------ |
| 初始化           |        | √          |        |        |        |        |        |        |          |        |
| 订单已创建       |        |            | √      | √      |        |        |        |        |          |        |
| 已取消           |        |            |        |        |        |        |        |        |          |        |
| 待支付           |        |            | √      |        | √      |        |        |        |          |        |
| 已付款           |        |            | √      |        |        | √      |        |        |          |        |
| 待发货           |        |            | √      |        |        |        | √      |        |          |        |
| 已发货           |        |            |        |        |        |        |        | √      | √        |        |
| 已签收           |        |            |        |        |        |        |        |        | √        |        |
| 退货申请         |        |            |        |        |        |        |        |        |          | √      |
| 已退货           |        |            |        |        |        |        |        |        |          |        |
|                  |        |            |        |        |        |        |        |        |          |        |
|                  |        |            |        |        |        |        |        |        |          |        |                                              |            |      |